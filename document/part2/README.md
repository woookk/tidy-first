# 02. 관리

- 목차
  - [Chapter 15. 코드 정리 시작](#chapter-15-코드-정리-시작)
  - [Chapter 16. 코드 정리 구분](#chapter-16-코드-정리-구분)
  - [Chapter 17. 연쇄적인 정리](#chapter-17-연쇄적인-정리)
  - [Chapter 18. 코드 정리의 일괄 처리량](#chapter-18-코드-정리의-일괄-처리량)
  - [Chapter 19. 리듬](#chapter-19-리듬)
  - [Chapter 20. 얽힘 풀기](#chapter-20-얽힘-풀기)
  - [Chapter 21. 코드 정리 시점](#chapter-21-코드-정리-시점)
  - [스터디](#스터디)

코드 정리 절차 관리를 다룬다. 코드를 정리하는 일이 반드시 보고해야 하고, 추적하고, 계획하고, 일정을 잡아야 하는 일이 되어서는 안된다. 특정 코드를 변경해야 하는데 코드가 지저분해서 변경하기 어려울 때, 먼저 코드를 정리하는 것이다. 일상적인 업무이자, 생각하면서 개선하는 절차이다.

코드 정리를 개인 개발 흐름에 맞추는 방법에 대해서도 설명한다.

- 코드 정리를 언제 시작하나요?
- 코드 정리는 언제 멈추나요?
- 코드의 구조를 변경하는 코드 정리와 시스템의 동작 변경을 어떻게 결합할 수 있을까요?

먼저 정리가 풀 리퀘스트(PR) 및 코드 검토와 어떻게 연관을 맺는지 논의해 보겠다.

# Chapter 16. 코드 정리 구분

> PR / Review 모델을 사용한다고 가정한다.
>

코드 정리를 하지 않는다면 모를까, 코드 정리를 하면 어딘가에서는 처리해야 한다. 그러면 어디서 해야할까?

요약하면, **코드 정리는 별도의 PR로 만들고**, **가급적 PR 당 몇 개의 코드 정리만 넣자.**

코드 정리 구분에 대한 장단점을 살펴보자. 크고 포괄적인 PR로 만들면 전체 그림을 보여주지만, 검토하는 입장에서는 유용한 피드백을 제공하기에는 너무 큰 덩어리일 수 있다. 반대로 아주 작은 PR은 소소한 피드백을 유도할 수 있지만, 잡초처럼 무시될 우려가 있다.

![[그림 1. Optimal Pull Request Size, [https://www.linkedin.com/pulse/size-pullmerge-request-more-important-than-you-think-rodrigo-miguel]]](/images/part2/optimal_pull_request_size.png)

https://www.linkedin.com/pulse/size-pullmerge-request-more-important-than-you-think-rodrigo-miguel

> So we should not do code review at a rate greater than 400 lines per hour. And so if we do not want to invest more than 1 hour in the review and we do not want to review more than 400 lines per hour, we can only conclude that we should not accept reviewing more than 400 lines at a time.
>

# Chapter 17. 연쇄적인 정리

코드를 계속 정리하고 싶은 충동을 관리하는 것도 코드 정리의 핵심 기술이다.

단계의 크기는 본인이 알아서 하겠지만, 권하는 것은 아주 작은 단계로 나누어 코드를 정리하는 방식을 고수하면서 실험을 해보는 것이다. 그러면서 각 단계를 최적화하자.

- 보호 구문
- 안 쓰는 코드 제거
- 대칭으로 맞추기
- 새로운 인터페이스로 기존 루틴 부르기
- 읽는 순서 정리
- 응집도를 높이는 배치
- 설명하는 변수
- 설명하는 상수
- 명시적인 매개변수
- 비슷한 코드끼리
- 도우미 추출
- 하나의 더미
- 설명하는 주석
- 불필요한 주석 지우기

> [!WARNING]
>
> 너무 많이, 빠르게 변경하지 않도록 주의하자. 대게 작은 정리를 순차적으로 성공하는 것이 무리한 정리로 실패하는 것보다 시간을 아껴준다.
>

# Chapter 18. 코드 정리의 일괄 처리량

통합과 배포를 하기 전에 코드 정리는 어느 정도 크기가 적절할까?

몇 가지 고려사항이 있다.

- 통합과 배포를 하기 전에 얼마나 많은 코드 정리를 해야할까?
    - 코드 정리를 다음 동작 변경을 돕는 구조 변경으로 본다면, 다음 동작 변경을 지원하기 위해 얼마나 많은 구조 변경이 필요할까?
    - 기본적으로 코드 정리는 먼 미래를 바라보는 것이 아니기 때문에 즉각적인 필요를 다뤄야 한다.
- 코드 정리의 크기가 어느 정도일 때 쉽게 통합하고 배포할 수 있을까?

**많은 조직에서 하나의 변경 사항을 검토하고 배포하는 데 드는 고정 비용은 상당히 많다.** 코드 정리 비용을 줄이고자 한다면, 코드 정리 개수를 늘려서 동작 변경에 소용되는 비용을 줄이자. 그러면, 검토 비용을 줄일 수 있다.

> 검토 비용을 제대로 줄일 수 있는 방법을 찾아야 한다. 팀에 신뢰와 강력한 문화가 있다면 코드 정리 후에는 굳이 검토할 필요가 없다. 검토하지 않더라도 코드 정리가 소프트웨어의 안정을 해치지 않으면 상호작용의 위험이 줄어든다.
> 
> 코드 정리 검토를 없앨 수준의 안전과 신뢰에 도달하려면, 적어도 몇 달의 기간이 걸린다. 실천하고, 실험하자. 오류를 팀과 함께 검토하자.

# Chapter 19. 리듬

코드 정리를 관리하는 기술 중에는 정리의 리듬을 관리하는 일도 있다.

특정 동작 변경 이전에 수행한 일련의 구조 변경에 얼마나 많은 시간이 소요될까? 소프트웨어 설계는 프렉탈(fractal)이므로 설계는 크게도 작게도 할 수 있다. 하지만, 이 책의 목적에 따라 소프트웨어 설계에 대한 한 가지 척도를 제시한다. 바로 개인에게 영향을 미치는 소프트웨어 설계이다. **분 단위를 유지하되, 한 시간을 넘지 않는다.** 한 번의 코드 정리에 한 시간 이상이 걸린다면, 이는 원하는 동작 변경을 위해 필요한 최소한의 구조 변경 시기를 놓쳤다는 의미일 수 있다.

**동작 변경은 코드 안에 뭉쳐서 나타나는 경향이 있다.**

파레토 법칙에 따르면 80%의 변경 사항이 20%의 파일에서 발생한다. 코드 정리를 선행할 때, 탁월한 장점 중에는 코드 정리 내용도 뭉쳐진다는 것이다. 그리고 코드 정리가 코드를 뭉친 결과는 정확하게 동작 변경하기에 가장 좋은 위치에 뭉쳐져 있다.

# Chapter 20. 얽힘 풀기

정리한 코드와 변경할 동작이 얽혀 버렸다면, 세 가지 선택이 있다.

- 그대로 배포할 수 있다. 검토하는 사람들이 무례하다 느끼고, 오류가 발생할 수 있지만 당장 처리할 수 있다.
- 코드 정리와 변경 사항을 하나 이상의 PR로 나누거나 하나의 PR을 여러 번의 커밋으로 나눌 수 있다. 이 방법으로 무례함은 줄일 수 있지만 작업 횟수는 늘어난다.
- 진행 중인 작업을 버리고, 코드 정리를 선행하는 순서로 다시 시작할 수 있다. 작업은 더 많아지지만, 이어지는 커밋과의 일관성은 분명해진다.

우리가 작성하는 코드는 컴퓨터에 지시할 뿐 아니라, 컴퓨터에 지시하려는 여러분의 의도를 사람들에게도 설명해야 하기 때문이다. 컴퓨터에 지시만 하는 빠른 수행이 흥미로운 최종 목표가 되는 것은 아니다.

세 번째 선택지를 실험해보라고 권하는 것이 놀랍지는 않을 것이다. 다시 구현하면서 새로운 것을 발견할 가능성도 높아지고 동일한 동작 변경을 하면서도 더 많은 가치를 끌어낼 수 있다.

# Chapter 21. 코드 정리 시점

코드 정리 시점에 대해서 논할 차례인데, 시스템의 동작 변경과 연관해서 보겠다. 

코드 정리를 먼저하고 나서, 동작 변경을 할까? 아니면 동작 변경을 먼저 한 후, 코드 정리를 할까? 아니면 이후 동작 변경에 어려움이 가중될 수 있으니 혼란스러운 부분을 메모로 남기고 정리는 나중으로 미룰까? 그것도 아니면 코드 정리를 하지 않을까?

### 아예 안한다면

가장 그럴듯한 이유는 코드의 동작이 앞으로 절대 바뀌지 않을 거라는 믿음이다. 코드의 동작을 변경할 필요가 없는 경우는 드물지만, 실제로 일어나는 경우가 있다. 진짜로 변경이 필요 없는 시스템이라면, 합리적으로 통한다.

### 나중에 정리하기

나중에 코드를 정리하겠다는 선택을 마치 정답처럼 여기는 이유는 지금 정리할 코드가 너무 많으니 언제 해도 상관없다는 논리이다. 정말 나중에 정리해도 무방하다. 하지만 전제 조건이 있다.

일을 할 시간은 충분한가? ‘시간이 충분하다면 어떻게 일할 것인가?’라고 스스로에게 물어보자. 그 대답이 실제로 하고 있는 일과 크게 다르다면, 일할 시간이 충분하지 않다는 뜻이다.

정리를 나중에 하는 일, 다시 말해 지금 변경한 동작과 연결되지 않는 코드 정리를 나중에 하면 몇 가지 다른 방식으로 가치를 창출한다.

한 가지는 지저분함 보유세를 줄이는 것이다.

코드 정리를 나중에 할 근거 중 하나는 학습 도구로 활용할 수 있다. 코드는 자신이 어떻게 구조화되고 싶은지 ‘알고’ 있다. 이 코드에 귀 기울이면서 현재 구조에서 원하는 구조로 옮기다 보면 무언가를 반드시 배우게 된다.

마지막으로, 코드 정리를 나중에 자신이 원할 때 하면 더 의욕적이고 기분도 좋다.

### 동작 변경 후에 코드 정리

코드를 어떻게 정리해야 할지 당장 모르고 일단 코드 동작을 변경해보자. 동작을 변경했으니, 이제 코드를 정리해야 할까? 상황에 따라 다르다.

동작 변경을 한 코드를 대상으로 다시 동작 변경이 이뤄질 가능성이 크다면 코드 정리가 상당한 의미가 있다.  이 부분은 다음 번 동작 변경을 할 때, 코드 정리부터 먼저 하는 것은 어떨까? 지금은 맥락을 알아서 더 쉽게 정리할 수 있는 일이지만, 나중에는 맥락을 잊어버릴 수 있기 때문이다. 또는 다른 변경 건이 생겨 코드 정리하는데 훼방을 놓을 수 있다. 나중에 코드 정리할 때까지 기다리느라 비용이 너무 많이 증가할 가능성이 있다면, 지금 정리 하는 것이 좋다.

정리는 동작 변경에 한 시간이 걸렸다고 가정하면, 한 시간 정도 코드 정리에 투자하는 것은 합리적이다.

다음의 경우라면 동작 변경 후 코드를 정리하자.

- 방금 고친 코드를 다시 변경할 예정일 때
- 지금 정리하는 것이 더 저렴할 때
- 코드 정리하는 데 드는 시간이 동작 변경에 드는 시간과 거의 비슷할 때

### 코드 정리 후에 동작 변경

코드 정리를 선행해야 할까? 상황에 따라 다르다.

스스로에게 질문을 해보자.

- 지저분한 상태 그대로 코드 기반으로 동작 변경을 한다면 일이 얼마나 더 어려운가?
    - 코드를 정리한다고 해서 더 쉬워지지 않는다면, 먼저 정리하지 말자
- 코드 정리의 이점을 바로 얻을 수 있는지?
    - 코드를 정리하고 더 빨리 이해할 수 있겠다고 판단이 서면, 먼저 코드를 정리하자
- 코드 정리에 드는 비용을 어떻게 보상받을 수 있을까?
    - 코드를 딱 한 번만 변경할 예정이라면 코드 정리는 제한하는 것이 좋다
    - 코드 정리로 몇 년 동안 매주 보상을 받는다면 먼저 하는 것이 좋다
- 코드 정리에 얼마나 확신을 하고 있는가?

일반적으로 코드를 먼저 정리하는 것이 선호되지만, 정리 그 자체를 목적으로 삼지 않도록 경계해야 한다.

### 요약

- **다음 상황에는 코드 정리를 하지 말자**
    - 앞으로 다시는 코드를 변경하지 않을 때
    - 설계를 개선하더라도 배울 것이 없을 때
- **다음 상황에서는 나중으로 정리를 미루자**
    - 정리할 코드 분량이 많은데, 보상이 바로 보이지 않을 때
    - 코드 정리에 대한 보상이 잠재적일 때
    - 작은 묶음으로 여러 번에 나눠서 코드 정리를 할 수 있을 때
- **다음 상황에서는 동작 변경 후에 정리하자**
    - 다음 코드 정리까지 기다릴수록 비용이 더 불어날 때
    - 코드 정리를 하지 않으면 일을 끝냈다는 느낌이 들지 않을 때
- **다음 상황에서는 코드 정리 후에 동작 변경을 하자**
    - 코드 정리를 했을 때 코드 이해가 쉬워지거나 동작 변경이 쉬워지는 즉각적인 효과를 얻을 수 있을 때
    - 어떤 코드를 어떻게 정리해야 하는지 알고 있을 때

---

# 스터디

- 각자 읽고 정리
- 더 얘기해볼 것
- 이해 안가는 부분
- 스터디 내용 관련 경험

## 더 얘기해볼 것

## 이해 안가는 부분

## **추가 자료 및 참고 링크**

- 도서
- 링크
  - [The Size of the Pull/Merge Request is More Important Than You Think](https://www.linkedin.com/pulse/size-pullmerge-request-more-important-than-you-think-rodrigo-miguel)
